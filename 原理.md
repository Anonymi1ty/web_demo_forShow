# 服务器部署

## Tomcat原理

![image-20220703104435733](../../../../../Typora/myimage/image-20220703104435733.png)



---

## servlet（部署成功后通过服务器验证请求）

#### 1.架构

![image-20220703115838982](../../../../../Typora/myimage/image-20220703115838982.png)

#### 2.继承体系

![image-20220703232755312](../../../../../Typora/myimage/image-20220703232755312.png)

**如果子类没有重写do相关方法，会报405错误**



#### 3.实现流程

-  编写一个类继承**HttpServlet**类
- 根据业务需要重写'**doGet'和'doPost**'方法
- 到**web.xml**中配置



#### 4.Http协议（请求与响应

##### i）请求（包含3个部分）：

![image-20220704090541011](../../../../../Typora/myimage/image-20220704090541011.png)

![image-20220704090624601](../../../../../Typora/myimage/image-20220704090624601.png)

- **请求行**
  - 请求的方式
  - 请求的URL
  - 请求的协议（一般是http1.1）
- **请求头**（包含了很多要告诉服务器的信息）

![image-20220704090902881](../../../../../Typora/myimage/image-20220704090902881.png)

- **请求体**
  - get方式，没有请求体，在url后面
  - post方式，有请求体，form data
  - json格式，有请求体，request payload

##### ii）响应（包含3部分）：

![image-20220704092021483](../../../../../Typora/myimage/image-20220704092021483.png)

- 响应行
  - 协议
  - 响应状态码
    - 200（正常响应
    - 404（找不到资源
    - 405（请求方式不支持
    - 500（服务器内部错误
  - 响应状态
- 响应头
  - 包含了服务器信息
  - 服务器发送给浏览器的信息
- 响应体
  - 响应的实际内容（例如<html><bady>...</html>



#### 5.会话

**http无状态**：服务器无法判断两次请求是一个客户端发过来的，还是不同客户端发过来的。

​	例如：添加商品到别人的购物车



**通过会话跟踪技术解决无状态问题**

![image-20220704093524794](../../../../../Typora/myimage/image-20220704093524794.png)

通过发送session获取ID，没有则创建新的请求，然后响应给客户端，下次客户端给服务器发送请求时，用已有ID进行访问

```java
//常用API
request.getSession()//获取一个会话，没有则创建新的
request.getSession(false)//获取一个会话，没有返回null，不会创建新的
    
session.getId()//获取sessionID
session.isNew()//判断是否是新的
session.invalidate()//强制性让会话失效（退出
```



##### session保存作用域

只要session不失效，可以通过session存储和取出数据

![image-20220704095126878](../../../../../Typora/myimage/image-20220704095126878.png)

```java
//常用API
session.setAttribute(k,v)//设置存储
session.getAttribute(k)//获取
```



#### 6.服务器内部转发和客户端重定向

```java
request.getRequestDispatcher("....").forward(request,response);//服务器内部转发
response.sendRedirect("...");//客户端重定向
```

##### 服务器内部转发

![image-20220704100247377](../../../../../Typora/myimage/image-20220704100247377.png)

结束后**访问请求不变**

##### 客户端重定向

![image-20220704100625176](../../../../../Typora/myimage/image-20220704100625176.png)

结束后**访问请求改变**



#### 7.Thymeleaf-视图模板技术

**简介：**SpringBoot官方推荐使用的视图模板技术，和SpringBoot完美整合

**执行流程：**

![image-20220705223257940](../../../../../Typora/myimage/image-20220705223257940.png)

##### 从三层架构到MVC

- MVC概念（出现在JavaEE中的Web层，**指导Web代码的分离**

  - **M:**Model模型，将与**业务逻辑**相关的数据封装成为一个具体的**javaBean**，其中不掺杂任何与数据处理相关的代码 --JavaBean/domain

  -   **V:**View视图  ：只负责**接收页面的数据显示**，不接受任何与显示数据无关的代码 --JSP/HTML

  - **C:**Controller：控制器只负责请求，**调用业务层代码处理请求**，然后派发页面 --Servlet

    - MVC是在展示层开发中的一种设计理念。主张把封**装数据的模型、显示用户界面的视图、协调调度的控制器分开**
    - 架构：

    ![image-20220705220034667](../../../../../Typora/myimage/image-20220705220034667.png)

    - 分别的作用

    ![image-20220705220034667](../../../../../Typora/myimage/image-20220705220034667.png)

- JavaEE的三层架构

![image-20220704104328717](../../../../../Typora/myimage/image-20220704104328717.png)

分层的目的是为了降低耦合，方便后期的维护和升级





#### idea中快速配置servlet方法

![image-20220703225919653](../../../../../Typora/myimage/image-20220703225919653.png)

![image-20220703225949893](../../../../../Typora/myimage/image-20220703225949893.png)

#### 记录功能实现

1.登录功能

![image-20220704185017941](../../../../../Typora/myimage/image-20220704185017941.png)

2.如果需要上线平台，记得动态修改base

3.WareHouseServlet中的数据存储在request域中，动态连接表时可以后续使用



### 总结web后台开发流程

1. 编写对应的数据库
2. 编写对应模块的**javabean**（pojo：用于接收数据库信息
3. 编写对应模块的**Dao**
4. 编写对应模块的**Service**层
5. 编写图书模块的**Web**层和页面测试